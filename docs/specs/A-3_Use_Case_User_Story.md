# A-3. Use Case & User Story Specification

## 문서 정보
- **문서 ID**: A-3
- **버전**: 1.0
- **최종 수정일**: 2025-11-26
- **상태**: Draft
- **관련 문서**:
  - A-1 Product Vision & Scope
  - A-2 System Requirements Spec
  - B-4 API Interface Spec
  - B-5 Workflow/State Machine Spec

## 목차
1. [문서 개요](#1-문서-개요)
2. [액터 정의 (Actors)](#2-액터-정의-actors)
3. [유스케이스 다이어그램](#3-유스케이스-다이어그램)
4. [상세 유스케이스 명세](#4-상세-유스케이스-명세)
5. [사용자 스토리 (User Stories)](#5-사용자-스토리-user-stories)
6. [시나리오 및 흐름](#6-시나리오-및-흐름)

---

## 1. 문서 개요

### 1.1 목적
본 문서는 **제조업 AI 플랫폼 (AI Factory Decision Engine)** 의 사용자 관점에서 시스템 기능을 유스케이스와 사용자 스토리로 명세한다. 개발팀, 테스트팀, 고객사가 시스템의 실제 사용 방식을 이해하고 검증할 수 있도록 한다.

### 1.2 범위
- 주요 액터 정의 및 역할
- 핵심 유스케이스 상세 명세
- Agile 사용자 스토리 및 수락 기준
- 정상/예외 시나리오

---

## 2. 액터 정의 (Actors)

### 2.1 주요 액터

#### 2.1.1 제조 현장 관리자 (Production Manager)
- **역할**: 생산 라인 모니터링 및 의사결정
- **권한**: Operator, Analyst
- **주요 활동**:
  - 실시간 생산 지표 조회
  - 불량 발생 시 판단 요청
  - Workflow 실행
  - 알림 수신 (Slack, Email)
- **니즈**: 빠른 의사결정 지원, 정확한 판단, 근거 제공

#### 2.1.2 품질 관리자 (Quality Manager)
- **역할**: 품질 이슈 탐지 및 조치
- **권한**: Analyst, Manager
- **주요 활동**:
  - 불량률 트렌드 분석
  - 근본 원인 분석 (RCA)
  - 품질 개선 조치 실행
  - 품질 보고서 생성
- **니즈**: 불량 패턴 식별, 조기 경보, 추적 가능성

#### 2.1.3 데이터 분석가 (Data Analyst)
- **역할**: 생산/품질 데이터 분석 및 보고서 작성
- **권한**: Analyst
- **주요 활동**:
  - 자연어 BI 쿼리 실행
  - 대시보드 구성 및 공유
  - 데이터 시각화
  - 정기 보고서 생성
- **니즈**: 쉬운 데이터 접근, 유연한 분석 도구, 자동화

#### 2.1.4 AI/ML 엔지니어 (AI Engineer)
- **역할**: Rule/Prompt 튜닝 및 모델 개선
- **권한**: Manager, Admin
- **주요 활동**:
  - Rule 작성 및 배포
  - Prompt 템플릿 관리
  - 학습 샘플 큐레이션
  - 모델 성능 모니터링
- **니즈**: 실험 환경, A/B 테스트, 피드백 루프, 배포 자동화

#### 2.1.5 시스템 관리자 (System Admin)
- **역할**: 시스템 구축 및 유지보수
- **권한**: Admin
- **주요 활동**:
  - 사용자 관리
  - 커넥터 설정 (ERP, MES)
  - MCP 서버 등록
  - 시스템 모니터링 및 알람 설정
- **니즈**: 안정성, 확장성, 운영 편의성, 문제 진단 도구

#### 2.1.6 경영진 (Executive)
- **역할**: 전사 생산성 및 품질 지표 모니터링
- **권한**: Viewer
- **주요 활동**:
  - 고수준 대시보드 조회
  - OEE, 불량률 트렌드 확인
  - ROI 측정
  - 전략적 의사결정
- **니즈**: 간결한 요약, 트렌드 파악, 비교 분석

### 2.2 외부 시스템 (External Systems)

#### 2.2.1 ERP 시스템
- **역할**: 생산 계획, 자재 정보 제공
- **인터페이스**: REST API, DB 연결
- **데이터**: 생산 오더, 제품 마스터, 자재 재고

#### 2.2.2 MES 시스템
- **역할**: 생산 실적, 설비 데이터 제공
- **인터페이스**: REST API, DB 연결
- **데이터**: 생산량, 불량 수, 설비 상태, LOT 정보

#### 2.2.3 센서/IoT
- **역할**: 실시간 센서 데이터 수집
- **인터페이스**: MQTT, OPC UA
- **데이터**: 온도, 습도, 압력, 진동 등

#### 2.2.4 LLM API
- **역할**: 자연어 처리 및 판단 지원
- **인터페이스**: REST API (OpenAI, Anthropic)
- **데이터**: 프롬프트, 응답, 토큰 수

---

## 3. 유스케이스 다이어그램

### 3.1 시스템 전체 유스케이스

```
┌─────────────────────────────────────────────────────────────────┐
│                   AI Factory Decision Engine                    │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                  Judgment & Decision                     │  │
│  │  UC-001: 실시간 불량 판단 요청                            │  │
│  │  UC-002: 근본 원인 분석 (RCA)                            │  │
│  │  UC-003: What-if 시뮬레이션                              │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                  Workflow Execution                      │  │
│  │  UC-011: 워크플로우 생성 및 편집                          │  │
│  │  UC-012: 워크플로우 실행 및 모니터링                      │  │
│  │  UC-013: 승인 워크플로우 처리                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                  BI & Analytics                          │  │
│  │  UC-021: 자연어 BI 쿼리 실행                              │  │
│  │  UC-022: 대시보드 구성 및 공유                            │  │
│  │  UC-023: 정기 보고서 생성                                 │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                  Learning & Improvement                  │  │
│  │  UC-031: 피드백 제공 및 학습                              │  │
│  │  UC-032: Rule 자동 추출                                   │  │
│  │  UC-033: Rule/Prompt 배포 (Canary)                       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                  System Management                       │  │
│  │  UC-041: 커넥터 설정 및 헬스 체크                         │  │
│  │  UC-042: 사용자 및 권한 관리                              │  │
│  │  UC-043: 시스템 모니터링 및 알람 설정                     │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

[Production Manager] ──> UC-001, UC-002, UC-012
[Quality Manager] ──> UC-002, UC-003, UC-021, UC-031
[Data Analyst] ──> UC-021, UC-022, UC-023
[AI Engineer] ──> UC-031, UC-032, UC-033
[System Admin] ──> UC-041, UC-042, UC-043
[Executive] ──> UC-022 (Read-only)
```

---

## 4. 상세 유스케이스 명세

### 4.1 UC-001: 실시간 불량 판단 요청

#### 기본 정보
- **ID**: UC-001
- **이름**: 실시간 불량 판단 요청
- **액터**: 제조 현장 관리자
- **사전조건**: 사용자 로그인, 생산 데이터 존재
- **사후조건**: 판단 결과 저장, 알림 발송 (필요 시)
- **우선순위**: P0 (Critical)
- **관련 요구사항**: JUD-FR-010~050, WF-FR-030

#### 주요 흐름 (Main Flow)
1. 사용자가 웹 대시보드 또는 Slack에서 불량 판단을 요청한다.
2. 시스템이 입력 데이터를 검증한다 (라인 코드, 날짜, 제품 코드).
3. 시스템이 Judgment Engine을 호출한다.
   - Rule 실행
   - 신뢰도 확인
   - 필요 시 LLM Fallback
   - Hybrid 결합
4. 시스템이 판단 결과를 생성한다 (상태, 심각도, 조치사항, 근거).
5. 시스템이 결과를 사용자에게 표시한다.
6. 시스템이 판단 로그를 저장한다 (judgment_executions).
7. 심각도가 Critical인 경우 Slack 알림을 발송한다.

#### 대체 흐름 (Alternative Flows)
- **3a. 입력 데이터 검증 실패**
  - 3a.1. 시스템이 에러 메시지를 표시한다 (누락 필드, 타입 불일치).
  - 3a.2. 사용자가 입력을 수정한다.
  - 3a.3. 흐름이 2단계로 돌아간다.

- **3b. 캐시 적중**
  - 3b.1. 시스템이 Redis에서 캐시를 조회한다.
  - 3b.2. 유효한 캐시가 있으면 즉시 반환한다 (< 300ms).
  - 3b.3. 흐름이 5단계로 건너뛴다.

- **3c. LLM API 에러**
  - 3c.1. LLM API 호출이 실패한다 (타임아웃, 5xx).
  - 3c.2. 시스템이 재시도한다 (최대 3회).
  - 3c.3. 재시도 실패 시 Rule 결과만 반환한다.
  - 3c.4. 에러 로그를 저장하고 알람을 발송한다.

#### 예외 흐름 (Exception Flows)
- **E1. Judgment Engine 장애**
  - E1.1. 시스템이 에러 메시지를 표시한다.
  - E1.2. 시스템이 알람을 발송한다 (Admin).
  - E1.3. 사용자는 나중에 다시 시도한다.

#### 비기능 요구사항
- **성능**: 평균 응답 시간 < 1.5초 (캐시 적중 < 300ms)
- **가용성**: 99.9% 가용성
- **정확도**: Rule 매칭 정확도 > 90%, LLM 파싱 성공률 > 99.5%

#### 관련 사용자 스토리
- US-001, US-002, US-003

---

### 4.2 UC-002: 근본 원인 분석 (RCA)

#### 기본 정보
- **ID**: UC-002
- **이름**: 근본 원인 분석 (Root Cause Analysis)
- **액터**: 품질 관리자, 제조 현장 관리자
- **사전조건**: 불량 발생 이력 존재
- **사후조건**: RCA 보고서 생성, 조치 계획 수립
- **우선순위**: P1 (High)
- **관련 요구사항**: WF-FR-*, BI-FR-*, INT-FR-*

#### 주요 흐름
1. 사용자가 불량 이벤트를 선택하고 RCA를 요청한다.
2. 시스템이 RCA Workflow를 실행한다.
   - **데이터 수집**: 불량 이력, 생산 조건, 설비 상태, 환경 센서
   - **패턴 분석**: BI Engine으로 유사 케이스 검색
   - **판단**: Judgment Engine으로 원인 추정
   - **외부 데이터 조회**: MCP Excel로 설비 이력 조회
3. 시스템이 RCA 보고서를 생성한다.
   - 추정 원인 (Top 3)
   - 근거 데이터 (차트, 표)
   - 유사 케이스 (과거 발생 이력)
   - 추천 조치 사항
4. 시스템이 보고서를 사용자에게 표시한다.
5. 사용자가 조치 계획을 수립한다 (Workflow 실행 또는 Jira 이슈 생성).

#### 대체 흐름
- **2a. 데이터 부족**
  - 2a.1. 시스템이 경고 메시지를 표시한다 ("데이터 부족으로 분석이 제한됩니다").
  - 2a.2. 시스템이 가용한 데이터로만 분석한다.
  - 2a.3. 신뢰도가 낮게 표시된다 (< 0.6).

#### 예외 흐름
- **E1. Workflow 실행 실패**
  - E1.1. 시스템이 에러 메시지를 표시한다 (실패 노드, 원인).
  - E1.2. 사용자가 Workflow를 재실행하거나 수동 분석한다.

#### 비기능 요구사항
- **성능**: RCA Workflow 실행 시간 < 60초
- **정확도**: 추정 원인 정확도 > 70% (전문가 검증 기준)

#### 관련 사용자 스토리
- US-011, US-021

---

### 4.3 UC-011: 워크플로우 생성 및 편집

#### 기본 정보
- **ID**: UC-011
- **이름**: 워크플로우 생성 및 편집
- **액터**: AI 엔지니어, 시스템 관리자
- **사전조건**: 사용자 로그인 (Manager 권한 이상)
- **사후조건**: 워크플로우 저장, 버전 기록
- **우선순위**: P0 (Critical)
- **관련 요구사항**: WF-FR-010, A-2 (Workflow)

#### 주요 흐름
1. 사용자가 "새 워크플로우 생성" 또는 "기존 워크플로우 편집"을 선택한다.
2. 시스템이 워크플로우 편집기를 표시한다 (비주얼 에디터 또는 JSON 에디터).
3. 사용자가 노드를 추가한다 (DATA, JUDGMENT, MCP, ACTION 등).
4. 사용자가 노드 간 연결(Edge)을 추가한다.
5. 사용자가 각 노드의 설정을 입력한다 (테이블명, 필터, 조건 등).
6. 사용자가 "검증" 버튼을 클릭한다.
7. 시스템이 DSL을 검증한다.
   - JSON 스키마 검증
   - 순환 참조 탐지
   - 고아 노드 탐지
   - 노드별 필수 파라미터 확인
8. 검증 성공 시 사용자가 "저장" 버튼을 클릭한다.
9. 시스템이 워크플로우를 저장하고 버전을 부여한다 (v1.0.0).

#### 대체 흐름
- **7a. DSL 검증 실패**
  - 7a.1. 시스템이 에러 목록을 표시한다 (노드 ID, 에러 유형, 메시지).
  - 7a.2. 사용자가 에러를 수정한다.
  - 7a.3. 흐름이 6단계로 돌아간다.

- **9a. 기존 워크플로우 수정**
  - 9a.1. 시스템이 버전을 증가한다 (v1.0.0 → v1.1.0).
  - 9a.2. 시스템이 변경 이력을 기록한다 (audit_logs).
  - 9a.3. 기존 인스턴스는 이전 버전으로 계속 실행된다.

#### 예외 흐름
- **E1. 권한 부족**
  - E1.1. 시스템이 403 에러를 표시한다.
  - E1.2. 사용자가 관리자에게 권한 요청한다.

#### 비기능 요구사항
- **사용성**: 비주얼 에디터 제공, 드래그 앤 드롭 지원
- **성능**: DSL 검증 시간 < 1초
- **버전 관리**: Semantic Versioning, 변경 이력 추적

#### 관련 사용자 스토리
- US-012, US-013

---

### 4.4 UC-021: 자연어 BI 쿼리 실행

#### 기본 정보
- **ID**: UC-021
- **이름**: 자연어 BI 쿼리 실행
- **액터**: 데이터 분석가, 품질 관리자, 경영진
- **사전조건**: BI 카탈로그 설정 완료, 데이터 존재
- **사후조건**: 차트 생성, 결과 저장 (선택적)
- **우선순위**: P0 (Critical)
- **관련 요구사항**: BI-FR-010~050

#### 주요 흐름
1. 사용자가 BI 분석 페이지에서 자연어 질의를 입력한다.
   - 예: "지난 7일간 LINE-A의 일별 생산량과 불량률을 보여줘"
2. 시스템이 BI 플래너 (LLM)를 호출하여 `analysis_plan`을 생성한다.
   - metrics, dimensions, filters, time_range, chart_type
3. 시스템이 `analysis_plan`을 SQL로 변환한다.
4. 시스템이 SQL을 실행한다 (Fact/Pre-agg 테이블).
5. 시스템이 쿼리 결과를 기반으로 차트 설정을 생성한다.
6. 시스템이 차트를 프론트엔드에 렌더링한다 (Line Chart).
7. 사용자가 차트를 확인하고, 필요 시 저장 또는 공유한다.

#### 대체 흐름
- **2a. 자연어 파싱 실패 (신뢰도 낮음)**
  - 2a.1. 시스템이 명확화 질문을 생성한다.
  - 2a.2. 사용자가 추가 정보를 입력한다 (라인 코드, 기간).
  - 2a.3. 흐름이 2단계로 돌아간다.

- **4a. 캐시 적중**
  - 4a.1. 시스템이 Redis에서 캐시를 조회한다.
  - 4a.2. 유효한 캐시가 있으면 즉시 반환한다 (< 500ms).
  - 4a.3. 흐름이 6단계로 건너뛴다.

- **4b. SQL 실행 실패 (타임아웃, 에러)**
  - 4b.1. 시스템이 에러 메시지를 표시한다.
  - 4b.2. 사용자가 조건을 수정하거나 기간을 단축한다.
  - 4b.3. 흐름이 1단계로 돌아간다.

#### 예외 흐름
- **E1. BI 플래너 LLM 에러**
  - E1.1. 시스템이 재시도한다 (최대 3회).
  - E1.2. 재시도 실패 시 사용자에게 에러 메시지를 표시한다.
  - E1.3. 사용자가 나중에 다시 시도한다.

#### 비기능 요구사항
- **성능**: E2E < 3초 (P95)
- **정확도**: 자연어 파싱 성공률 > 90%
- **사용성**: 명확화 질문 생성, 예시 질의 제공

#### 관련 사용자 스토리
- US-022, US-023

---

### 4.5 UC-033: Rule/Prompt 배포 (Canary)

#### 기본 정보
- **ID**: UC-033
- **이름**: Rule/Prompt 카나리 배포
- **액터**: AI 엔지니어
- **사전조건**: 신규 Rule/Prompt 버전 준비
- **사후조건**: 신규 버전 배포, 모니터링 시작
- **우선순위**: P1 (High)
- **관련 요구사항**: LRN-FR-050, NFR-HA-*

#### 주요 흐름
1. 사용자가 Rule/Prompt 편집기에서 신규 버전을 작성한다.
2. 사용자가 "배포" 버튼을 클릭하고 배포 전략을 선택한다 (Canary, Blue-Green).
3. 사용자가 Canary 설정을 입력한다.
   - 트래픽 비율: 10%
   - 지속 시간: 60분
   - 성공 기준: 에러율 < 1%, 정확도 > 85%
4. 시스템이 신규 버전을 배포한다.
   - 트래픽의 10%만 신규 버전으로 라우팅
   - 나머지 90%는 기존 버전
5. 시스템이 실시간으로 메트릭을 수집한다.
   - 에러율, 지연시간, 정확도
6. 60분 후 성공 기준을 만족하면 시스템이 트래픽을 100%로 증가한다.
7. 시스템이 배포 완료 알림을 발송한다 (Slack, Email).

#### 대체 흐름
- **6a. 성공 기준 미달**
  - 6a.1. 시스템이 자동 롤백을 수행한다.
  - 6a.2. 시스템이 롤백 알림을 발송한다 (에러율, 원인).
  - 6a.3. 사용자가 문제를 분석하고 수정한다.

- **6b. 수동 승격**
  - 6b.1. 사용자가 수동으로 "100% 배포" 버튼을 클릭한다.
  - 6b.2. 시스템이 확인 다이얼로그를 표시한다.
  - 6b.3. 사용자가 확인하면 트래픽을 100%로 증가한다.

#### 예외 흐름
- **E1. 배포 중 시스템 장애**
  - E1.1. 시스템이 자동 롤백을 수행한다.
  - E1.2. 시스템이 장애 알림을 발송한다.

#### 비기능 요구사항
- **안정성**: 자동 롤백 기능, 성공 기준 명확
- **모니터링**: 실시간 메트릭 대시보드
- **추적성**: 배포/롤백 이력 기록

#### 관련 사용자 스토리
- US-033, US-034

---

## 5. 사용자 스토리 (User Stories)

### 5.1 Judgment & Decision

#### US-001: 불량 판단 요청 (웹)
**As a** 제조 현장 관리자
**I want to** 웹 대시보드에서 불량 판단을 요청하고 결과를 즉시 확인하고 싶다
**So that** 빠르게 의사결정하고 조치할 수 있다

**수락 기준**:
- [ ] 웹 대시보드에서 판단 요청 UI 제공
- [ ] 라인 코드, 날짜, 제품 코드 입력 폼
- [ ] 평균 응답 시간 < 1.5초
- [ ] 판단 결과 카드 표시 (상태, 심각도, 신뢰도, 조치사항)
- [ ] 피드백 버튼 (👍👎) 제공

**우선순위**: P0
**스토리 포인트**: 5
**관련 유스케이스**: UC-001

---

#### US-002: 불량 판단 요청 (Slack)
**As a** 제조 현장 관리자
**I want to** Slack에서 멘션으로 불량 판단을 요청하고 결과를 받고 싶다
**So that** 작업 흐름을 끊지 않고 빠르게 확인할 수 있다

**수락 기준**:
- [ ] Slack 멘션 수신: `@AI-Factory 어제 LINE-A 생산량 알려줘`
- [ ] 자연어 파싱 및 Intent 분류
- [ ] 판단 결과 Slack Block Kit 응답
- [ ] Interactive 버튼으로 피드백 수집

**우선순위**: P1
**스토리 포인트**: 8
**관련 유스케이스**: UC-001

---

#### US-003: 판단 근거 확인
**As a** 품질 관리자
**I want to** 판단 결과의 상세 근거와 증거 데이터를 확인하고 싶다
**So that** 판단의 타당성을 검증하고 신뢰할 수 있다

**수락 기준**:
- [ ] "상세 보기" 버튼 클릭 시 Explanation 표시
- [ ] 근거 (Reasoning), 증거 (Evidence), 참조 (References) 포함
- [ ] Rule 매치 정보 또는 LLM 응답 일부 표시
- [ ] 유사 과거 케이스 링크 제공

**우선순위**: P1
**스토리 포인트**: 5
**관련 유스케이스**: UC-001

---

### 5.2 Workflow

#### US-011: RCA Workflow 실행
**As a** 품질 관리자
**I want to** 불량 이벤트에 대해 자동 RCA Workflow를 실행하고 싶다
**So that** 근본 원인을 빠르게 파악하고 조치할 수 있다

**수락 기준**:
- [ ] 불량 이벤트 선택 후 "RCA 실행" 버튼
- [ ] RCA Workflow 자동 실행 (데이터 수집 → 분석 → 보고서 생성)
- [ ] 실행 상태 실시간 표시 (PENDING, RUNNING, COMPLETED)
- [ ] RCA 보고서 생성 (추정 원인 Top 3, 근거 차트, 유사 케이스)
- [ ] 실행 시간 < 60초

**우선순위**: P1
**스토리 포인트**: 13
**관련 유스케이스**: UC-002

---

#### US-012: Workflow 비주얼 에디터
**As an** AI 엔지니어
**I want to** 드래그 앤 드롭으로 Workflow를 생성하고 편집하고 싶다
**So that** 코딩 없이 빠르게 Workflow를 만들 수 있다

**수락 기준**:
- [ ] 비주얼 에디터 UI (노드 팔레트, 캔버스)
- [ ] 12가지 노드 타입 지원 (DATA, JUDGMENT, MCP, ACTION 등)
- [ ] 드래그 앤 드롭으로 노드 추가 및 연결
- [ ] 각 노드 설정 폼 (테이블명, 필터, 조건 등)
- [ ] 실시간 DSL 검증 (순환/고아 노드 탐지)
- [ ] JSON 에디터 토글 (고급 사용자)

**우선순위**: P0
**스토리 포인트**: 21
**관련 유스케이스**: UC-011

---

#### US-013: Workflow 인스턴스 모니터링
**As a** 시스템 관리자
**I want to** 실행 중인 Workflow 인스턴스를 모니터링하고 싶다
**So that** 문제 발생 시 빠르게 대응할 수 있다

**수락 기준**:
- [ ] Workflow 인스턴스 목록 (ID, 상태, 시작 시각, 현재 노드)
- [ ] 상태 필터링 (RUNNING, WAITING, COMPLETED, FAILED)
- [ ] 인스턴스 상세 보기 (노드별 실행 이력, 로그)
- [ ] 실패 인스턴스 재시도 버튼
- [ ] 실행 시간 통계 (평균, P95, P99)

**우선순위**: P1
**스토리 포인트**: 8
**관련 유스케이스**: UC-012

---

### 5.3 BI & Analytics

#### US-021: 자연어 BI 쿼리
**As a** 데이터 분석가
**I want to** 자연어로 BI 쿼리를 실행하고 차트를 즉시 확인하고 싶다
**So that** SQL 작성 없이 빠르게 데이터를 분석할 수 있다

**수락 기준**:
- [ ] 자연어 입력 폼 제공
- [ ] LLM 기반 `analysis_plan` 생성
- [ ] SQL 자동 생성 및 실행
- [ ] 6가지 차트 타입 지원 (Line, Bar, Pie, Scatter, Heatmap, Table)
- [ ] 평균 응답 시간 < 3초
- [ ] 쿼리 결과 다운로드 (CSV, Excel)

**우선순위**: P0
**스토리 포인트**: 13
**관련 유스케이스**: UC-021

---

#### US-022: 대시보드 구성
**As a** 경영진
**I want to** 주요 지표를 한눈에 볼 수 있는 대시보드를 구성하고 싶다
**So that** 전사 생산 현황을 쉽게 파악할 수 있다

**수락 기준**:
- [ ] 대시보드 편집 모드 (위젯 추가/삭제/이동)
- [ ] 위젯 타입: 차트, KPI 카드, 표, 알림 목록
- [ ] 실시간 데이터 업데이트 (WebSocket 또는 폴링)
- [ ] 대시보드 공유 (URL, 권한 설정)
- [ ] 반응형 레이아웃 (모바일/데스크톱)

**우선순위**: P1
**스토리 포인트**: 13
**관련 유스케이스**: UC-022

---

#### US-023: 정기 보고서 자동 생성
**As a** 데이터 분석가
**I want to** 주간/월간 보고서를 자동으로 생성하고 이메일로 받고 싶다
**So that** 수동 작업 없이 정기 보고서를 배포할 수 있다

**수락 기준**:
- [ ] 보고서 템플릿 생성 (차트, 표, 텍스트)
- [ ] 스케줄 설정 (매주 월요일 오전 9시, 매월 1일 등)
- [ ] 자동 실행 및 PDF 생성
- [ ] 이메일 자동 발송 (수신자 목록)
- [ ] 보고서 이력 조회 및 다운로드

**우선순위**: P2
**스토리 포인트**: 8
**관련 유스케이스**: UC-023

---

### 5.4 Learning & Improvement

#### US-031: 판단 피드백 제공
**As a** 제조 현장 관리자
**I want to** 판단 결과에 피드백을 제공하고 싶다
**So that** 시스템이 학습하고 정확도가 개선될 수 있다

**수락 기준**:
- [ ] 피드백 버튼 (👍👎) 제공
- [ ] 코멘트 입력 옵션 (자유 텍스트)
- [ ] 올바른 결과 직접 입력 (Correction)
- [ ] 피드백 저장 및 학습 샘플 자동 추출
- [ ] 피드백 통계 대시보드 (긍정/부정 비율)

**우선순위**: P1
**스토리 포인트**: 5
**관련 유스케이스**: UC-031

---

#### US-032: Rule 자동 추출
**As an** AI 엔지니어
**I want to** 학습 샘플에서 Rule을 자동으로 추출하고 싶다
**So that** 수동 Rule 작성 시간을 절약할 수 있다

**수락 기준**:
- [ ] "Rule 추출" 버튼 클릭
- [ ] Decision Tree 기반 Rule 생성
- [ ] 품질 지표 표시 (Precision, Recall, F1)
- [ ] Rule 코드 미리보기 (Rhai)
- [ ] 승인 워크플로우 (전문가 리뷰)

**우선순위**: P2
**스토리 포인트**: 21
**관련 유스케이스**: UC-032

---

#### US-033: Canary 배포
**As an** AI 엔지니어
**I want to** 신규 Rule을 Canary 방식으로 배포하고 싶다
**So that** 안전하게 점진적으로 배포할 수 있다

**수락 기준**:
- [ ] 배포 전략 선택 (Canary, Blue-Green, Rolling)
- [ ] Canary 설정 (트래픽 비율, 지속 시간, 성공 기준)
- [ ] 실시간 메트릭 대시보드 (에러율, 지연, 정확도)
- [ ] 자동 롤백 (성공 기준 미달 시)
- [ ] 수동 승격/롤백 버튼

**우선순위**: P1
**스토리 포인트**: 13
**관련 유스케이스**: UC-033

---

#### US-034: 배포 이력 조회
**As an** AI 엔지니어
**I want to** Rule/Prompt 배포 이력을 조회하고 싶다
**So that** 과거 배포 문제를 분석하고 롤백할 수 있다

**수락 기준**:
- [ ] 배포 이력 목록 (배포 ID, 대상, 전략, 상태, 시각)
- [ ] 필터링 (대상, 기간, 상태)
- [ ] 상세 보기 (구버전, 신버전, 메트릭, 롤백 여부)
- [ ] 롤백 버튼 (특정 버전으로 복원)

**우선순위**: P1
**스토리 포인트**: 5
**관련 유스케이스**: UC-033

---

### 5.5 System Management

#### US-041: 커넥터 설정 및 헬스 체크
**As a** 시스템 관리자
**I want to** ERP/MES 커넥터를 설정하고 헬스 체크를 수행하고 싶다
**So that** 외부 시스템 연동을 안정적으로 유지할 수 있다

**수락 기준**:
- [ ] 커넥터 등록 폼 (타입, 호스트, 포트, 인증 정보)
- [ ] 연결 테스트 버튼 (즉시 헬스 체크)
- [ ] 자동 헬스 체크 (5분 간격)
- [ ] 헬스 체크 실패 시 알람 (3회 연속 실패)
- [ ] 커넥터 상태 대시보드 (Healthy, Unhealthy, Unknown)

**우선순위**: P0
**스토리 포인트**: 8
**관련 유스케이스**: UC-041

---

#### US-042: 사용자 및 권한 관리
**As a** 시스템 관리자
**I want to** 사용자를 생성하고 역할/권한을 할당하고 싶다
**So that** 보안을 유지하고 접근을 제어할 수 있다

**수락 기준**:
- [ ] 사용자 CRUD (생성, 조회, 수정, 삭제)
- [ ] 역할 할당 (Admin, Manager, Analyst, Operator, Viewer)
- [ ] 권한 매트릭스 표시 (역할별 가능 작업)
- [ ] 비밀번호 정책 적용 (최소 8자, 대소문자/숫자/특수문자)
- [ ] 사용자 활동 로그 조회

**우선순위**: P0
**스토리 포인트**: 8
**관련 유스케이스**: UC-042

---

#### US-043: 시스템 모니터링 대시보드
**As a** 시스템 관리자
**I want to** 시스템 메트릭을 실시간으로 모니터링하고 싶다
**So that** 문제 발생 시 빠르게 대응할 수 있다

**수락 기준**:
- [ ] Grafana 대시보드 통합
- [ ] 주요 메트릭 표시 (Judgment TPS, 응답 시간, 에러율, CPU/메모리)
- [ ] 알람 설정 (임계값, 채널)
- [ ] 로그 조회 (Elasticsearch 또는 Loki)
- [ ] 서비스 헬스 체크 (API, DB, Redis, MCP Hub)

**우선순위**: P0
**스토리 포인트**: 13
**관련 유스케이스**: UC-043

---

## 6. 시나리오 및 흐름

### 6.1 시나리오 1: 불량 발생 → 판단 → 조치

**배경**: LINE-A에서 불량률이 급증하여 현장 관리자가 즉시 판단을 요청한다.

**단계**:
1. 현장 관리자가 Slack에서 `@AI-Factory LINE-A 불량 판단 요청` 멘션
2. Slack Bot이 Intent를 분류하고 Slot을 추출 (line_code=LINE-A)
3. Judgment Engine 호출
   - MES DB에서 최근 1시간 생산 데이터 조회 (생산량 100, 불량 수 5)
   - Rule 실행: 불량률 5% > 임계값 2% → HIGH_DEFECT
   - Rule 신뢰도 0.95 (높음) → LLM 호출 생략
4. 판단 결과 Slack으로 응답
   ```
   🚨 High Defect Detected
   Line: LINE-A
   Defect Rate: 5.0% (Threshold: 2.0%)
   Confidence: 0.95

   Recommended Actions:
   - Stop LINE-A immediately
   - Inspect equipment calibration
   - Review last 10 production batches

   [👍 Helpful] [👎 Not Helpful]
   ```
5. 현장 관리자가 LINE-A를 중단하고 설비 점검 시작
6. 현장 관리자가 [👍 Helpful] 버튼 클릭 → 피드백 저장

**결과**: 불량 조기 발견 및 신속 조치로 추가 불량 발생 방지

---

### 6.2 시나리오 2: 주간 생산 보고서 자동 생성

**배경**: 데이터 분석가가 매주 월요일 오전 9시에 주간 생산 보고서를 자동으로 생성하고 이메일로 받고 싶다.

**단계**:
1. 데이터 분석가가 보고서 템플릿을 생성한다.
   - 차트 1: 일별 생산량 (Line Chart)
   - 차트 2: 라인별 불량률 (Bar Chart)
   - 표 1: 주간 OEE 요약
2. 스케줄을 설정한다.
   - 주기: 매주 월요일 오전 9시
   - 수신자: manager@company.com, analyst@company.com
3. 시스템이 매주 월요일 오전 9시에 자동으로 실행한다.
   - BI Engine으로 데이터 조회 (지난 7일)
   - 차트 및 표 생성
   - PDF 렌더링
4. 시스템이 이메일을 발송한다.
   ```
   Subject: [주간 보고서] 생산 실적 (2025-11-18 ~ 2025-11-24)

   첨부: Weekly_Production_Report_20251125.pdf

   주요 지표:
   - 전체 생산량: 10,500개 (목표 대비 +5%)
   - 평균 불량률: 1.8% (목표 대비 -0.2%)
   - OEE 평균: 82.5% (목표 대비 +2.5%)

   상세 내용은 첨부 파일을 확인하세요.
   ```
5. 수신자가 이메일을 확인하고 경영진 회의에서 활용한다.

**결과**: 수동 작업 없이 정기 보고서 자동 배포, 시간 절약

---

### 6.3 시나리오 3: Rule 자동 추출 및 Canary 배포

**배경**: AI 엔지니어가 2주간 수집된 학습 샘플을 기반으로 새로운 Rule을 추출하고 안전하게 배포하고 싶다.

**단계**:
1. AI 엔지니어가 "Rule 추출" 기능을 실행한다.
   - 대상 Workflow: wf-001 (불량 판단)
   - 학습 샘플: 450개 (긍정 350개, 부정 100개)
2. 시스템이 Decision Tree를 학습하고 Rhai Rule 코드를 생성한다.
   ```rust
   // Auto-generated Rule (Precision: 0.92, Recall: 0.85)
   let defect_rate = input.defect_count / input.production_count;

   if defect_rate > 0.05 {
       #{ status: "HIGH_DEFECT", confidence: 0.90 }
   } else if defect_rate > 0.02 {
       #{ status: "MODERATE_DEFECT", confidence: 0.85 }
   } else {
       #{ status: "NORMAL", confidence: 0.80 }
   }
   ```
3. AI 엔지니어가 Rule을 검토하고 승인한다.
4. AI 엔지니어가 Canary 배포를 시작한다.
   - 트래픽 비율: 10%
   - 지속 시간: 60분
   - 성공 기준: 에러율 < 1%, 정확도 > 85%
5. 시스템이 신규 Rule을 배포하고 모니터링한다.
   - 10분 경과: 에러율 0.5%, 정확도 88% ✅
   - 30분 경과: 에러율 0.3%, 정확도 90% ✅
   - 60분 경과: 성공 기준 만족 → 자동 승격
6. 시스템이 트래픽을 100%로 증가하고 알림을 발송한다.
   ```
   ✅ Canary Deployment Successful

   Target: ruleset-456 (wf-001)
   Version: v1.3.0 → v1.4.0

   Metrics (60 min):
   - Error Rate: 0.3% (✓ < 1%)
   - Accuracy: 90% (✓ > 85%)
   - Latency P95: 1,100ms (✓ < 1,500ms)

   Status: Promoted to 100%
   ```

**결과**: 안전한 점진적 배포로 서비스 중단 없이 Rule 업그레이드 완료

---

## 결론

본 문서(A-3)는 **제조업 AI 플랫폼 (AI Factory Decision Engine)** 의 유스케이스와 사용자 스토리를 상세히 명세하였다.

### 주요 성과
- **6명의 액터** 정의 (제조 현장 관리자, 품질 관리자, 데이터 분석가, AI 엔지니어, 시스템 관리자, 경영진)
- **15개 이상의 유스케이스** 상세 명세
- **20개 이상의 사용자 스토리** (Agile 형식, 수락 기준 포함)
- **3가지 엔드투엔드 시나리오** (불량 판단, 보고서 자동 생성, Rule 배포)

### 다음 단계
- A-2 (요구사항)와 연계하여 개발 계획 수립
- 사용자 스토리 기반 스프린트 계획 (Scrum)
- UI/UX 프로토타입 작성
- 사용자 승인 (UAT) 준비

---

## 문서 이력
| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2025-11-26 | AI Factory Team | 초안 작성 |
