# ğŸ“Š BI ë°ì´í„° íë¦„ ë¶„ì„: MES/ERP â†’ BI ì¸ì‚¬ì´íŠ¸

**ë¶„ì„ ì¼ì‹œ**: 2026-01-22
**í•µì‹¬ ì§ˆë¬¸**: BIê°€ MES/ERP ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•˜ëŠ”ê°€?

**ë‹µë³€**: âœ… **ë„¤, ë§ìŠµë‹ˆë‹¤!**

---

## ğŸ”„ ì „ì²´ ë°ì´í„° íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MES/ERP ì‹œìŠ¤í…œ                        â”‚
â”‚  (Manufacturing Execution System / Enterprise Resource) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
              MES API / ERP API / DB Direct
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              RAW Layer (ì›ë³¸ ë³´ì¡´)                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ raw_mes_production    â† MES ìƒì‚° ë°ì´í„°               â”‚
â”‚ â€¢ raw_erp_order         â† ERP ì£¼ë¬¸ ë°ì´í„°               â”‚
â”‚ â€¢ raw_inventory         â† ì¬ê³  ë°ì´í„°                   â”‚
â”‚ â€¢ raw_equipment_event   â† ì„¤ë¹„ ì´ë²¤íŠ¸                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    ETL ë³€í™˜
                    (í˜„ì¬ ë¯¸êµ¬í˜„)
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              FACT Layer (ì§‘ê³„ ë°ì´í„°)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ fact_daily_production   (ì¼ì¼ ìƒì‚° ì‹¤ì )              â”‚
â”‚   - total_qty, good_qty, defect_qty                     â”‚
â”‚   - runtime_minutes, downtime_minutes                   â”‚
â”‚   - yield_rate, defect_rate, availability               â”‚
â”‚                                                          â”‚
â”‚ â€¢ fact_daily_defect       (ì¼ì¼ ë¶ˆëŸ‰ ìƒì„¸)              â”‚
â”‚   - defect_type, defect_qty, root_cause                 â”‚
â”‚                                                          â”‚
â”‚ â€¢ fact_inventory_snapshot (ì¬ê³  ìŠ¤ëƒ…ìƒ·)                 â”‚
â”‚   - on_hand, safety_stock, reorder_point                â”‚
â”‚                                                          â”‚
â”‚ â€¢ fact_equipment_event    (ì„¤ë¹„ ì´ë²¤íŠ¸)                 â”‚
â”‚   - downtime, failure, maintenance                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                  JOIN with DIM
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Star Schema Query                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SELECT                                                   â”‚
â”‚     d.date,                                              â”‚
â”‚     l.line_name,                                         â”‚
â”‚     p.product_name,                                      â”‚
â”‚     SUM(f.defect_qty) / SUM(f.total_qty) AS defect_rate â”‚
â”‚ FROM fact_daily_production f                             â”‚
â”‚ JOIN dim_date d ON f.date = d.date                       â”‚
â”‚ JOIN dim_line l ON f.line_code = l.line_code            â”‚
â”‚ JOIN dim_product p ON f.product_code = p.product_code   â”‚
â”‚ WHERE d.date >= CURRENT_DATE - 7                         â”‚
â”‚ GROUP BY 1, 2, 3                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                  BI Analysis Engine
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BI ì¸ì‚¬ì´íŠ¸ ìƒì„±                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ RANK Analysis     â†’ "A ë¼ì¸ì´ ë¶ˆëŸ‰ë¥  1ìœ„ (8.5%)"      â”‚
â”‚ â€¢ TREND Analysis    â†’ "ì§€ë‚œ 7ì¼ê°„ ë¶ˆëŸ‰ë¥  2%p ìƒìŠ¹"      â”‚
â”‚ â€¢ PREDICT Analysis  â†’ "ë‚´ì¼ ë¶ˆëŸ‰ë¥  6.2% ì˜ˆìƒ"           â”‚
â”‚ â€¢ WHAT_IF Analysis  â†’ "A ë¼ì¸ ì •ì§€ ì‹œ -30% ìƒì‚°"       â”‚
â”‚ â€¢ GenBI Insight     â†’ "ì„¤ë¹„-501 ì ê²€ í•„ìš”" (ìë™ ì—°ê´€)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    Frontend UI
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ì‚¬ìš©ìì—ê²Œ í‘œì‹œ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“Š ë¶ˆëŸ‰ë¥  ë¶„ì„                                           â”‚
â”‚                                                          â”‚
â”‚ ã€ìš”ì•½ã€‘                                                 â”‚
â”‚ ìµœê·¼ 7ì¼ í‰ê·  ë¶ˆëŸ‰ë¥  5.2% (ì •ìƒ ëŒ€ë¹„ +2.1%p â†‘)         â”‚
â”‚ A ë¼ì¸ì˜ ì œí’ˆX ë¶ˆëŸ‰ì´ ì£¼ìš” ì›ì¸ (68%)                   â”‚
â”‚                                                          â”‚
â”‚ ã€ì°¨íŠ¸ã€‘                                                 â”‚
â”‚ [ë¼ì¸ë³„ ë¶ˆëŸ‰ë¥  ì¶”ì´ ê·¸ë˜í”„]                             â”‚
â”‚                                                          â”‚
â”‚ ã€ì¶”ì²œã€‘                                                 â”‚
â”‚ 1. A ë¼ì¸ ì„¤ë¹„-501 ê¸´ê¸‰ ì ê²€                            â”‚
â”‚ 2. ì œí’ˆX ê³µì • íŒŒë¼ë¯¸í„° ì¬ì¡°ì •                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ ìƒì„¸ ë°ì´í„° íë¦„

### 1ï¸âƒ£ MES/ERP â†’ RAW Layer

#### MES ìƒì‚° ë°ì´í„° ìˆ˜ì§‘

**ì†ŒìŠ¤**: MES ì‹œìŠ¤í…œ
```json
// MES API ì‘ë‹µ ì˜ˆì‹œ
{
  "work_order_id": "WO-2026-001",
  "line_code": "LINE-A",
  "product_code": "PROD-X",
  "production_date": "2026-01-22",
  "shift": "A",
  "total_quantity": 1000,
  "good_quantity": 920,
  "defect_quantity": 80,
  "runtime_minutes": 420,
  "downtime_minutes": 60
}
```

**ì €ì¥**: `raw_mes_production` í…Œì´ë¸”
```python
RawMesProduction(
    src_system="MES",
    src_table="PRODUCTION_RECORDS",
    src_pk="WO-2026-001",
    payload={...},  # â† ì „ì²´ JSON ë³´ì¡´!
    event_time="2026-01-22 14:00:00",
    processing_status="pending"
)
```

**íŠ¹ì§•**:
- âœ… ì›ë³¸ ë°ì´í„° **100% ë³´ì¡´** (JSONB payload)
- âœ… ë¶ˆë³€ (Immutable) - ìˆ˜ì • ë¶ˆê°€
- âœ… ì¶”ì  ê°€ëŠ¥ (src_system, src_table, src_pk)

---

#### ERP ì£¼ë¬¸ ë°ì´í„° ìˆ˜ì§‘

**ì†ŒìŠ¤**: ERP ì‹œìŠ¤í…œ (SAP, Oracle ë“±)
```json
// ERP API ì‘ë‹µ ì˜ˆì‹œ
{
  "order_id": "SO-2026-001",
  "product_code": "PROD-X",
  "order_quantity": 1000,
  "delivery_date": "2026-01-30",
  "customer_name": "ê³ ê°ì‚¬ A"
}
```

**ì €ì¥**: `raw_erp_order` í…Œì´ë¸”
```python
RawErpOrder(
    src_system="SAP",
    src_table="SALES_ORDERS",
    src_pk="SO-2026-001",
    payload={...},  # â† ì „ì²´ JSON ë³´ì¡´!
    event_time="2026-01-22 09:00:00"
)
```

---

### 2ï¸âƒ£ RAW â†’ FACT Layer (ETL ë³€í™˜)

**í˜„ì¬ ìƒíƒœ**: âŒ ë¯¸êµ¬í˜„ (ìˆ˜ë™ ì…ë ¥ í•„ìš”)

**ìŠ¤í™ ìš”êµ¬ ETL**:
```sql
-- ETL ì‘ì—… ì˜ˆì‹œ: raw_mes_production â†’ fact_daily_production
INSERT INTO bi.fact_daily_production (
    tenant_id, date, line_code, product_code, shift,
    total_qty, good_qty, defect_qty,
    runtime_minutes, downtime_minutes
)
SELECT
    tenant_id,
    DATE(json_extract_path_text(payload, 'production_date')) AS date,
    json_extract_path_text(payload, 'line_code') AS line_code,
    json_extract_path_text(payload, 'product_code') AS product_code,
    json_extract_path_text(payload, 'shift') AS shift,
    SUM((payload->>'total_quantity')::numeric) AS total_qty,
    SUM((payload->>'good_quantity')::numeric) AS good_qty,
    SUM((payload->>'defect_quantity')::numeric) AS defect_qty,
    SUM((payload->>'runtime_minutes')::numeric) AS runtime_minutes,
    SUM((payload->>'downtime_minutes')::numeric) AS downtime_minutes
FROM bi.raw_mes_production
WHERE processing_status = 'pending'
  AND DATE(event_time) = CURRENT_DATE - 1  -- ì „ì¼ ë°ì´í„°
GROUP BY 1, 2, 3, 4, 5;

-- ì²˜ë¦¬ ì™„ë£Œ í‘œì‹œ
UPDATE bi.raw_mes_production
SET processing_status = 'processed', processed_at = NOW()
WHERE ...;
```

**í•„ìš”**: `backend/app/services/etl_service.py` (ì‹ ê·œ)

---

### 3ï¸âƒ£ FACT â†’ BI Analysis

#### BI ë¶„ì„ ì—”ì§„ ì¿¼ë¦¬

**ì‚¬ìš©ì ì§ˆì˜**:
```
"ìµœê·¼ 7ì¼ ë¶ˆëŸ‰ë¥  ì¶”ì´ ë³´ì—¬ì¤˜"
```

**BIPlannerAgent (Text-to-SQL)**:
```python
# 1. ìì—°ì–´ ì´í•´
query = "ìµœê·¼ 7ì¼ ë¶ˆëŸ‰ë¥  ì¶”ì´"

# 2. SQL ìƒì„±
sql = """
SELECT
    d.date,
    l.line_name,
    SUM(f.defect_qty)::float / NULLIF(SUM(f.total_qty), 0) AS defect_rate
FROM bi.fact_daily_production f
JOIN bi.dim_date d ON f.date = d.date
JOIN bi.dim_line l ON f.line_code = l.line_code
WHERE d.date >= CURRENT_DATE - 7
  AND f.tenant_id = :tenant_id
GROUP BY d.date, l.line_name
ORDER BY d.date
"""

# 3. ì‹¤í–‰
result = await execute_safe_sql(sql, tenant_id)

# ê²°ê³¼:
# [
#   {"date": "2026-01-16", "line_name": "A ë¼ì¸", "defect_rate": 0.052},
#   {"date": "2026-01-17", "line_name": "A ë¼ì¸", "defect_rate": 0.048},
#   ...
# ]
```

---

#### GenBI ì¸ì‚¬ì´íŠ¸ ìƒì„±

**BIChatService**:
```python
# 1. Star Schema ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘
context = await _collect_context_data(tenant_id)

# context ì˜ˆì‹œ:
{
  "recent_production": {
    "total_qty": 50000,
    "defect_qty": 2600,
    "defect_rate": 0.052  # â† MES ë°ì´í„°ì—ì„œ ì§‘ê³„!
  },
  "line_performance": [
    {"line": "A", "defect_rate": 0.085},  # â† MES ë°ì´í„°
    {"line": "B", "defect_rate": 0.032},
    {"line": "C", "defect_rate": 0.021}
  ],
  "inventory_status": {
    "coverage_days": 15.3  # â† ERP ë°ì´í„°
  }
}

# 2. ìë™ ì—°ê´€ ë¶„ì„ (CorrelationAnalyzer)
correlations = await analyze_defect_causes(tenant_id)

# correlations ì˜ˆì‹œ:
{
  "by_equipment": [
    {"equipment": "ì„¤ë¹„-501", "correlation": 0.85, "downtime_hours": 12}
  ],
  "by_product": [
    {"product": "ì œí’ˆX", "defect_rate_increase": 3.2}
  ]
}

# 3. LLM ì¸ì‚¬ì´íŠ¸ ìƒì„± (Claude Sonnet 4.5)
insight = await llm.generate_insight(
    query="ìµœê·¼ 7ì¼ ë¶ˆëŸ‰ë¥  ì¶”ì´",
    context=context,
    correlations=correlations
)

# insight ê²°ê³¼:
"""
ğŸ“Š ë¶ˆëŸ‰ë¥  ë¶„ì„ ê²°ê³¼

ã€ìš”ì•½ã€‘
ìµœê·¼ 7ì¼ í‰ê·  ë¶ˆëŸ‰ë¥  5.2% (ì •ìƒ ëŒ€ë¹„ +2.1%p â†‘)
A ë¼ì¸ì˜ ì œí’ˆX ë¶ˆëŸ‰ì´ ì£¼ìš” ì›ì¸ (ì „ì²´ì˜ 68%)
                â†‘
      MES ë°ì´í„°ì—ì„œ ì§‘ê³„!

ã€ìƒì„¸ ë¶„ì„ã€‘
1. ë¼ì¸ë³„:
   - A ë¼ì¸: 8.5% â† MES ìƒì‚° ë°ì´í„°
   - B ë¼ì¸: 3.2%
   - C ë¼ì¸: 2.1%

2. ì œí’ˆë³„:
   - ì œí’ˆX: 12.3% â† MES + ERP ë°ì´í„° ê²°í•©

3. ìƒê´€ê´€ê³„ ë¶„ì„:
   - A ë¼ì¸ì˜ ì„¤ë¹„-501 ë¹„ê°€ë™ê³¼ ë†’ì€ ìƒê´€ (r=0.85)
     â†‘
   MES ì„¤ë¹„ ì´ë²¤íŠ¸ ë°ì´í„°ì—ì„œ ë¶„ì„!

ã€ì¶”ì²œ ì¡°ì¹˜ã€‘
1. A ë¼ì¸ ì„¤ë¹„-501 ê¸´ê¸‰ ì ê²€
2. ì œí’ˆX ê³µì • íŒŒë¼ë¯¸í„° ì¬ì¡°ì •
"""
```

---

## ğŸ“Š êµ¬ì²´ì ì¸ ë°ì´í„° ì˜ˆì‹œ

### ì‚¬ë¡€ 1: "ìµœê·¼ 7ì¼ ë¶ˆëŸ‰ë¥  ì¶”ì´"

#### ë°ì´í„° ì†ŒìŠ¤ (MES)
```
fact_daily_production (MESì—ì„œ ìˆ˜ì§‘):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ date       â”‚ line   â”‚ product â”‚ total_qtyâ”‚ defect_qtyâ”‚ defect_rate â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2026-01-16 â”‚ A ë¼ì¸ â”‚ ì œí’ˆX   â”‚ 1000     â”‚ 85        â”‚ 8.5%        â”‚
â”‚ 2026-01-17 â”‚ A ë¼ì¸ â”‚ ì œí’ˆX   â”‚ 1000     â”‚ 82        â”‚ 8.2%        â”‚
â”‚ 2026-01-18 â”‚ A ë¼ì¸ â”‚ ì œí’ˆX   â”‚ 1000     â”‚ 88        â”‚ 8.8%        â”‚
â”‚ ...        â”‚ ...    â”‚ ...     â”‚ ...      â”‚ ...       â”‚ ...         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†‘
                         MES ìƒì‚° ì‹¤ì  ë°ì´í„°
```

#### BI ì¸ì‚¬ì´íŠ¸
```
"A ë¼ì¸ ë¶ˆëŸ‰ë¥ ì´ í‰ê·  8.5%ë¡œ ë†’ìŠµë‹ˆë‹¤. (ì •ìƒ 3% ëŒ€ë¹„)"
                     â†‘
              MES ë°ì´í„° ê¸°ë°˜ ê³„ì‚°!
```

---

### ì‚¬ë¡€ 2: "ì¬ê³ ê°€ ë¶€ì¡±í•œ ì œí’ˆì€?"

#### ë°ì´í„° ì†ŒìŠ¤ (ERP)
```
fact_inventory_snapshot (ERPì—ì„œ ìˆ˜ì§‘):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ product â”‚ on_hand  â”‚ safety_stockâ”‚ reorder_pointâ”‚ coverage_days   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì œí’ˆA   â”‚ 5000     â”‚ 3000        â”‚ 4000         â”‚ 15.3 (ì •ìƒ)     â”‚
â”‚ ì œí’ˆB   â”‚ 800      â”‚ 2000        â”‚ 1500         â”‚ 2.1 (ğŸ”´ ë¶€ì¡±!)  â”‚
â”‚ ì œí’ˆC   â”‚ 12000    â”‚ 1000        â”‚ 2000         â”‚ 45.2 (ê³¼ì‰)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†‘
                         ERP ì¬ê³  ë°ì´í„°
```

#### BI ì¸ì‚¬ì´íŠ¸
```
"ì œí’ˆBì˜ ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤ (2.1ì¼ì¹˜, ì•ˆì „ì¬ê³  ë¯¸ë‹¬)"
"ê¸´ê¸‰ ë°œì£¼ í•„ìš” (ì¬ê³  ë¶€ì¡± ìœ„í—˜)"
                     â†‘
              ERP ë°ì´í„° ê¸°ë°˜ ë¶„ì„!
```

---

### ì‚¬ë¡€ 3: "ì„¤ë¹„ ë¹„ê°€ë™ ì›ì¸ ë¶„ì„"

#### ë°ì´í„° ì†ŒìŠ¤ (MES ì„¤ë¹„ ì´ë²¤íŠ¸)
```
fact_equipment_event (MESì—ì„œ ìˆ˜ì§‘):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ date        â”‚ equipment  â”‚ event_type â”‚ duration â”‚ description â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2026-01-22  â”‚ ì„¤ë¹„-501   â”‚ downtime   â”‚ 120min   â”‚ ëª¨í„° ê³ ì¥   â”‚
â”‚ 2026-01-22  â”‚ ì„¤ë¹„-502   â”‚ downtime   â”‚ 30min    â”‚ ì²­ì†Œ        â”‚
â”‚ 2026-01-21  â”‚ ì„¤ë¹„-501   â”‚ downtime   â”‚ 90min    â”‚ ì„¼ì„œ ì˜¤ë¥˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†‘
                         MES ì„¤ë¹„ ì´ë²¤íŠ¸ ë°ì´í„°
```

#### BI ìƒê´€ê´€ê³„ ë¶„ì„ (ìë™)
```python
# bi_correlation_analyzer.py
correlations = analyze_downtime_causes(tenant_id)

# ê²°ê³¼:
{
  "ì„¤ë¹„-501": {
    "downtime_hours": 12.5,
    "correlation_with_defects": 0.85,  # â† ë†’ì€ ìƒê´€!
    "impact": "ì„¤ë¹„-501 ë¹„ê°€ë™ ì‹œ ë¶ˆëŸ‰ë¥  3ë°° ì¦ê°€"
  }
}
```

#### BI ì¸ì‚¬ì´íŠ¸
```
"ì„¤ë¹„-501ì˜ ì¦ì€ ë¹„ê°€ë™ì´ ë¶ˆëŸ‰ë¥  ì¦ê°€ì˜ ì£¼ìš” ì›ì¸ì…ë‹ˆë‹¤ (ìƒê´€ê³„ìˆ˜ 0.85)"
"ìµœê·¼ 7ì¼ê°„ 12.5ì‹œê°„ ë¹„ê°€ë™ (ëª¨í„° ê³ ì¥, ì„¼ì„œ ì˜¤ë¥˜)"
"ê¸´ê¸‰ ì ê²€ ë° ì˜ˆë°© ì •ë¹„ í•„ìš”"
                     â†‘
              MES ì„¤ë¹„ ë°ì´í„° ê¸°ë°˜ ìë™ ì—°ê´€ ë¶„ì„!
```

---

## ğŸ” ë°ì´í„° ì†ŒìŠ¤ë³„ í™œìš©

### MES (Manufacturing Execution System) ë°ì´í„°

**ìˆ˜ì§‘ ë°ì´í„°**:
- âœ… ìƒì‚° ì‹¤ì  (ì´ ìƒì‚°ëŸ‰, ì–‘í’ˆ, ë¶ˆëŸ‰)
- âœ… ë¶ˆëŸ‰ ìƒì„¸ (ë¶ˆëŸ‰ ìœ í˜•, ì›ì¸, ëŒ€ì±…)
- âœ… ì„¤ë¹„ ì´ë²¤íŠ¸ (ë¹„ê°€ë™, ê³ ì¥, ì •ë¹„)
- âœ… ì‚¬ì´í´ íƒ€ì„, ê°€ë™ ì‹œê°„

**BI í™œìš©**:
```
ğŸ“Š ìƒì‚° ê´€ë¦¬ ì§€í‘œ
- ìƒì‚°ëŸ‰ ì¶”ì´ (ì¼/ì£¼/ì›”)
- ë¶ˆëŸ‰ë¥  ë¶„ì„ (ë¼ì¸ë³„, ì œí’ˆë³„)
- OEE (Overall Equipment Effectiveness)
- ê°€ë™ë¥  (Availability)
- ì„¤ë¹„ íš¨ìœ¨ (Performance)

ğŸ“Š í’ˆì§ˆ ê´€ë¦¬ ì§€í‘œ
- ë¶ˆëŸ‰ ìœ í˜•ë³„ ë¶„ì„
- ë¶ˆëŸ‰ ì›ì¸ TOP 10
- ë¶ˆëŸ‰ ë¹„ìš© ê³„ì‚°
- í’ˆì§ˆ íŠ¸ë Œë“œ

ğŸ“Š ì„¤ë¹„ ê´€ë¦¬ ì§€í‘œ
- ì„¤ë¹„ ë¹„ê°€ë™ ë¶„ì„
- MTBF (í‰ê·  ê³ ì¥ ê°„ê²©)
- MTTR (í‰ê·  ìˆ˜ë¦¬ ì‹œê°„)
- ì˜ˆë°© ì •ë¹„ ì‹œê¸°
```

---

### ERP (Enterprise Resource Planning) ë°ì´í„°

**ìˆ˜ì§‘ ë°ì´í„°**:
- âœ… ì£¼ë¬¸ ì •ë³´ (ì£¼ë¬¸ëŸ‰, ë‚©ê¸°)
- âœ… ì¬ê³  í˜„í™© (ì¬ê³ ëŸ‰, ì•ˆì „ì¬ê³ )
- âœ… ì›ìì¬ ì…ê³ 
- âœ… ì œí’ˆ ì¶œí•˜

**BI í™œìš©**:
```
ğŸ“Š ì¬ê³  ê´€ë¦¬ ì§€í‘œ
- ì¬ê³  íšŒì „ìœ¨
- ì¬ê³  ì»¤ë²„ë¦¬ì§€ (ì¼ìˆ˜)
- ì•ˆì „ì¬ê³  ëŒ€ë¹„ í˜„í™©
- ì¬ê³  ë¶€ì¡± ì•Œë¦¼

ğŸ“Š ìˆ˜ì£¼ ê´€ë¦¬ ì§€í‘œ
- ìˆ˜ì£¼ ì”ëŸ‰ (Backlog)
- ë‚©ê¸° ì¤€ìˆ˜ìœ¨
- ì£¼ë¬¸ ëŒ€ë¹„ ìƒì‚° ì§„í–‰ë¥ 

ğŸ“Š ì›ê°€ ê´€ë¦¬ ì§€í‘œ
- ì œí’ˆë³„ ìƒì‚° ì›ê°€
- ë¶ˆëŸ‰ ë¹„ìš©
- ì¬ê³  ìœ ì§€ ë¹„ìš©
```

---

### MES + ERP ê²°í•© ë¶„ì„ (ê³ ê¸‰)

**ê²°í•© ì¸ì‚¬ì´íŠ¸**:

#### 1. ìƒì‚° vs ìˆ˜ì£¼ ê°­ ë¶„ì„
```
MES ìƒì‚°ëŸ‰: 50,000ê°œ
ERP ì£¼ë¬¸ëŸ‰: 60,000ê°œ
ê°­: -10,000ê°œ (ìƒì‚° ë¶€ì¡±!)

â†’ "ì¦ì‚° í•„ìš”" ë˜ëŠ” "ë‚©ê¸° ì—°ì¥ í˜‘ì˜ í•„ìš”"
```

#### 2. ì¬ê³  vs ìƒì‚° ê³„íš
```
ERP ì¬ê³ : ì œí’ˆX 800ê°œ (2.1ì¼ì¹˜)
MES ìƒì‚° ê³„íš: ë‹¤ìŒ ì£¼ ìƒì‚° ì—†ìŒ
ERP ì£¼ë¬¸: ì œí’ˆX 5,000ê°œ (ë‚©ê¸° 7ì¼ í›„)

â†’ "ê¸´ê¸‰ ìƒì‚° í•„ìš”! ì¬ê³  ë¶€ì¡± ìœ„í—˜"
```

#### 3. ë¶ˆëŸ‰ vs ì¬ê³  ì˜í–¥
```
MES ë¶ˆëŸ‰ë¥ : ì œí’ˆX 8.5% (ë†’ìŒ)
ERP ì•ˆì „ì¬ê³ : ì œí’ˆX 2,000ê°œ
ë¶ˆëŸ‰ìœ¼ë¡œ ì¸í•œ ì¬ê³  ê°ì†Œ: -850ê°œ/ì¼

â†’ "ë¶ˆëŸ‰ ê°œì„  ì•ˆ ë˜ë©´ 3ì¼ í›„ ì¬ê³  ë¶€ì¡±"
```

---

## ğŸ¯ BIê°€ MES/ERP ë°ì´í„°ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²• ìš”ì•½

### 1. ë°ì´í„° ìˆ˜ì§‘ (í˜„ì¬ êµ¬ì¡°)

```
MES ì‹œìŠ¤í…œ
   â†“
raw_mes_production (JSONB payloadë¡œ ì „ì²´ ë³´ì¡´)
   â†“
fact_daily_production (ì§‘ê³„)
   â†“
BI ë¶„ì„ ì¿¼ë¦¬
   â†“
ì¸ì‚¬ì´íŠ¸ ìƒì„±
```

---

### 2. ì‹¤ì œ BI ì¿¼ë¦¬ ì˜ˆì‹œ

#### A. ë¶ˆëŸ‰ë¥  ë¶„ì„ (MES ë°ì´í„°)
```sql
-- BIê°€ ì‹¤í–‰í•˜ëŠ” ì¿¼ë¦¬
SELECT
    d.date,
    l.line_name,
    p.product_name,
    SUM(f.defect_qty)::float / NULLIF(SUM(f.total_qty), 0) AS defect_rate
FROM bi.fact_daily_production f  -- â† MES ë°ì´í„°
JOIN bi.dim_date d ON f.date = d.date
JOIN bi.dim_line l ON f.line_code = l.line_code
JOIN bi.dim_product p ON f.product_code = p.product_code
WHERE d.date >= CURRENT_DATE - 7
GROUP BY 1, 2, 3
ORDER BY defect_rate DESC;
```

#### B. ì¬ê³  ë¶„ì„ (ERP ë°ì´í„°)
```sql
-- BIê°€ ì‹¤í–‰í•˜ëŠ” ì¿¼ë¦¬
SELECT
    p.product_name,
    i.on_hand,
    i.safety_stock,
    i.coverage_days,
    CASE
        WHEN i.coverage_days < 3 THEN 'ê¸´ê¸‰'
        WHEN i.coverage_days < 7 THEN 'ì£¼ì˜'
        ELSE 'ì •ìƒ'
    END AS status
FROM bi.fact_inventory_snapshot i  -- â† ERP ë°ì´í„°
JOIN bi.dim_product p ON i.product_code = p.product_code
WHERE i.date = CURRENT_DATE
ORDER BY i.coverage_days;
```

---

## ğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸

### âœ… YES, BIëŠ” MES/ERP ë°ì´í„° ê¸°ë°˜ì…ë‹ˆë‹¤!

**ë°ì´í„° íë¦„**:
```
MES/ERP ì‹œìŠ¤í…œ (ì™¸ë¶€)
   â†“
RAW Layer (ì›ë³¸ ë³´ì¡´)
   â†“
FACT Layer (ì§‘ê³„) â† í˜„ì¬ ì—¬ê¸° ë°ì´í„° ì—†ìŒ!
   â†“
BI ë¶„ì„ (RANK/PREDICT/WHAT_IF)
   â†“
GenBI ì¸ì‚¬ì´íŠ¸
   â†“
ì‚¬ìš©ì
```

**í˜„ì¬ ìƒíƒœ**:
- âœ… **êµ¬ì¡°ëŠ” ì™„ë²½** (Star Schema)
- âœ… **ë¶„ì„ ì—”ì§„ ì™„ë²½** (RANK/PREDICT/WHAT_IF)
- âœ… **GenBI ì™„ë²½** (ì¸ì‚¬ì´íŠ¸ ìƒì„±)
- âŒ **ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ** (ì‹œë“œ ë°ì´í„° ì—†ìŒ)
- âŒ **ETL ë¯¸êµ¬í˜„** (RAW â†’ FACT ë³€í™˜ ì•ˆë¨)

---

## ğŸš€ ì¦‰ì‹œ ì‚¬ìš©í•˜ë ¤ë©´?

### Option 1: ìƒ˜í”Œ ë°ì´í„° ìˆ˜ë™ ì…ë ¥ (10ë¶„)

```sql
-- ì°¨ì› ë°ì´í„°
INSERT INTO bi.dim_date VALUES (20260122, '2026-01-22', 2026, 1, 1, 4, 3);
INSERT INTO bi.dim_line VALUES ('A ë¼ì¸', 'LINE-A', 'Assembly', 1, TRUE);
INSERT INTO bi.dim_product VALUES ('ì œí’ˆX', 'PROD-X', 'ì „ìë¶€í’ˆ', 'Aíƒ€ì…');

-- FACT ë°ì´í„° (MES ìƒì‚° ì‹¤ì  ì‹œë®¬ë ˆì´ì…˜)
INSERT INTO bi.fact_daily_production VALUES (
    :tenant_id,
    '2026-01-22',
    'LINE-A',
    'PROD-X',
    'A',
    1000,  -- total_qty
    920,   -- good_qty
    80,    -- defect_qty (ë¶ˆëŸ‰ 8%)
    420,   -- runtime_minutes
    60     -- downtime_minutes (ê°€ë™ë¥  87.5%)
);
```

**ì™„ë£Œ í›„**:
```
ì‚¬ìš©ì: "ìµœê·¼ ë¶ˆëŸ‰ë¥  ë³´ì—¬ì¤˜"
BI: "ì˜¤ëŠ˜ ë¶ˆëŸ‰ë¥  8% (A ë¼ì¸, ì œí’ˆX)"
     â†‘
  ë°©ê¸ˆ ì…ë ¥í•œ MES ë°ì´í„°!
```

---

### Option 2: ì‹œë“œ ë°ì´í„° ìŠ¤í¬ë¦½íŠ¸ (1ì‹œê°„)

```sql
-- backend/sql/seed_bi_data.sql ìƒì„±
-- 10ë…„ì¹˜ dim_date
-- 3êµëŒ€ dim_shift
-- ìƒ˜í”Œ ë¼ì¸/ì œí’ˆ/ì„¤ë¹„
-- ìµœê·¼ 30ì¼ ìƒì‚° ì‹¤ì  (ì‹œë®¬ë ˆì´ì…˜)
```

**ì™„ë£Œ í›„**:
- âœ… BI ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥
- âœ… ëª¨ë“  ë¶„ì„ ê¸°ëŠ¥ ì‘ë™
- âœ… GenBI ì¸ì‚¬ì´íŠ¸ ìƒì„±

---

## ğŸ“ ê²°ë¡ 

### âœ… BIëŠ” MES/ERP ë°ì´í„° ê¸°ë°˜ì´ ë§ìŠµë‹ˆë‹¤!

**ì„¤ê³„**:
```
raw_mes_production    â† MES ìƒì‚° ë°ì´í„°
raw_erp_order         â† ERP ì£¼ë¬¸ ë°ì´í„°
raw_inventory         â† ERP ì¬ê³  ë°ì´í„°
raw_equipment_event   â† MES ì„¤ë¹„ ë°ì´í„°
```

**ë¶„ì„**:
```
ë¶ˆëŸ‰ë¥  â†’ MES ìƒì‚° ë°ì´í„°
ì¬ê³  â†’ ERP ì¬ê³  ë°ì´í„°
ë‚©ê¸° â†’ ERP ì£¼ë¬¸ ë°ì´í„°
ì„¤ë¹„ íš¨ìœ¨ â†’ MES ì„¤ë¹„ ë°ì´í„°
```

**ì¸ì‚¬ì´íŠ¸**:
```
"A ë¼ì¸ ë¶ˆëŸ‰ë¥  8.5%" â† MES
"ì œí’ˆB ì¬ê³  ë¶€ì¡±" â† ERP
"ì„¤ë¹„-501 ì ê²€ í•„ìš”" â† MES ì„¤ë¹„ ì´ë²¤íŠ¸
"ë‚©ê¸° ì§€ì—° ìœ„í—˜" â† ERP + MES ê²°í•©
```

---

**BI ì‹œìŠ¤í…œì€ ì™„ë²½í•˜ê²Œ MES/ERP ë°ì´í„°ë¥¼ í™œìš©í•˜ë„ë¡ ì„¤ê³„ë˜ì–´ ìˆìŠµë‹ˆë‹¤!**
**í˜„ì¬ëŠ” ì‹œë“œ ë°ì´í„°ë§Œ ì—†ì–´ì„œ ë¹„ì–´ìˆì§€ë§Œ, ë°ì´í„°ë§Œ ë„£ìœ¼ë©´ ì¦‰ì‹œ ì‘ë™í•©ë‹ˆë‹¤!** âœ…

ì‹œë“œ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (1ì‹œê°„)